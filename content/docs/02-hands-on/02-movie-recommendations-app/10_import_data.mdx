---
title: 10. データのインポート
description: Import Data
icon: CloudDownload
---

## データのインポート

データのインポートを進めていきます。

### 1. コレクションの作成

import { Step, Steps } from 'fumadocs-ui/components/steps';

<Steps>
<Step>

#### 1-1. ポータルに戻る

Astra DB で、OpenAI Embeddings との統合が完了したら、ポータルに戻ります。

ヘッダにある、「Back to portal」をクリックすると、ポータルに戻ります。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_back_to_portal.png)

</Step>

<Step>

#### 1-2. コレクションの名前と埋め込み生成方法

事前に作成したデータベースを開き、「Load Data」ボタンをクリックします。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_submit_load_data_button_in_db.png)

注意事項の確認メッセージがモーダルで開くので、内容に問題がなければ「Continue」ボタンをクリックします。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_submit_continue_button_in_important_notes_modal.png)

提供されるサンプルコレクションを使用するか、自分で空のコレクションを作成するかを選択できます。

今回は、準備したデータをこの後、インポートしたいので、「Create Empty Collection」ボタンをクリックします。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_submit_create_empty_collection_button.png)


今回は「movies」という名前のコレクションを作成します。

Embedding generation method は、「Open AI」との統合を選択します。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_enter_collection_name.png)

</Step>

<Step>

#### 1-3. 埋め込みモデルの選択

OpenAI Embeddings モデルを選択します。

古いモデル（例: text-embedding-ada-002）から新しいモデル（例: text-embedding-3-large）まで利用可能です。

今回は、「text-embedding-3-large」モデルを選択します。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_select_embedding_model.png)

</Step>

<Step>

#### 1-4. 次元数と類似度計算の選択

次元数（Demensions）に今回は、「512」を設定します。
次元数が高いほど精度が向上しますが、計算コストが増加します。

類似度計算（Simillarity metric）の選択も求められます。選択肢は以下の通りです。

---

##### 1. コサイン類似度（Cosine）

ベクトルの方向を比較します。
大きさに関係なく類似性を評価するのに理想的です（テキストや画像の埋め込み、ユーザーの好み、推薦システムなど）。

##### 2. ドット積（Dot Product）

コサイン類似度の高速版で、すべての保存されたベクトルが単位長に正規化されている場合にのみ使用し、推奨されます。

##### 3. ユークリッド距離（Euclidean）

直線距離を計算します。幾何学的空間で最も近い点を見つけるのに理想的です（センサーデータ、クラスタリングなど）。

---

この中では「コサイン類似度（Cosine）」を選択することが一般的です。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_enter_dimensions_value_and_select_simillarity_metric.png)

</Step>

<Step>

#### 1-5. コレクション作成の実行

設定必須項目をすべて入力、選択できたら、「Create collection」ボタンをクリックします。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_submit_create_collection_button_in_create_collection_modal.png)

「movies」コレクションが作成されたことを確認します。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_created_movies_collections.png)

</Step>
</Steps>

### 2. データのインポート

<Steps>
<Step>

#### 2-1. データ形式の選択

「Load Data」ボタンをクリックします。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_submit_load_data_button_in_collection.png)

Load Data 画面が開いたら、読み込み対象のデータが「構造化されたデータかどうか」を選択します。

CSV ファイルをインポートするので「Structured Data」を選択します。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_select_structured_data_in_loda_data_modal.png)

</Step>

<Step>

#### 2-2. ドラッグ＆ドロップでのインポート

以下の CSV ファイルを Astra DB にドラッグ＆ドロップでインポートします。

import { File, Folder, Files } from "fumadocs-ui/components/files";

<Files>
  <Folder name="src" defaultOpen>
    <Folder name="data" defaultOpen>
      <a href="/02-hands-on/02-movie-recommendations-app/src/data/import_data.csv" target="_blank">
        <File name="import_data.csv" />
      </a>
    </Folder>
  </Folder>
</Files>

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_drug_and_drop_csv_file_for_importing_data.png)

この CSV データは、OMDb API から取得したデータです。

OMDb API - The Open Movie Database<br />
https://www.omdbapi.com

OMDb API (The Open Movie Database API) は、映画、テレビシリーズ、ビデオゲームに関する情報を取得するための API サービスです。

もし、RapidAPI などの API プラットフォームのアカウントを持っていれば、RapidAPI からも OMDb API は利用できます。

</Step>

<Step>

#### 2-3. ベクトル化対象のフィールドを選択

ドラッグ＆ドロップしたデータがテーブルで表示されるので、内容を確認します。

<img
  src="/02-hands-on/02-movie-recommendations-app/10_import_data/check_loaded_csv_data.webp"
  alt=""
/>

映画情報の「プロット（あらすじ）」フィールドをベクトル化対象として選択します。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_select_plot_field_for_field_to_vectorize.png)

Astra DB が自動的にプロット情報をベクトル化し、データセットを作成します。

</Step>

<Step>

#### 2-4. 読み込みデータベクトル化の実行

プレビューデータが確認出来たら、「Load Data」ボタンをクリックします。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_submit_load_data_button_after_checking_preview_data.png)

Astra DB が自動的にプロット情報をベクトル化し、データセットを作成します。

データの取り込みが完了して、250 件のレコードが登録されたことがわかります。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_added_250_recoreds_to_movies_collection.png)

</Step>
</Steps>

### 3. ベクトルデータの確認

レコードのフィールドのうち、「$vector」となっているのが、ベクトル情報のフィールドです。

Collections のダッシュボードで、対象レコードの Copy アイコンをクリックすると、ベクトルの値をコピーすることができます。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_copy_vecror_from_movies_collection.png)

Collection を作成する際に次元数を「512」で指定したので、ベクトルの値をみると、512 の異なるデータポイントがあることがわかります。

```py title="$vector"
[-0.056213725,0.00496472,-0.0052685617,-0.030254407,-0.014844011,-0.05758249,-0.003318663,-0.010973712,-0.021664232,-0.030372404,0.025015345,0.0044012847,-0.10223252,0.0532874,-0.035304673,-0.00066410133,-0.07981311,0.1027989,-0.020118473,-0.07599001,0.046325587,-0.05257942,0.014065231,0.028390056,0.004162341,0.002559058,0.015433995,-0.011687594,-0.018537315,0.060414415,0.036673438,0.00060067803,0.02938123,0.0060827406,-0.058054477,0.07447965,0.047599953,-0.017298346,0.0064249313,0.11544818,0.0040561436,-0.058620863,0.034101106,0.06338794,0.0684382,-0.0611696,-0.015257,-0.0532874,0.01336905,0.0045281313,-0.034761887,-0.025062542,0.00083630305,-0.047647152,-0.05187144,-0.0010096111,0.0014277626,-0.026218913,-0.0342427,0.011138908,-0.007929392,0.014018033,-0.04375325,-0.005569454,0.0688158,0.004873272,0.045900796,-0.03544627,-0.015351398,0.042077698,0.07127013,0.003696253,-0.104686856,-0.014348424,-0.011964886,-0.03348752,0.024189366,-0.021062449,-0.012790864,-0.093736745,-0.022832401,-0.0067789224,0.042903677,0.045122016,-0.0114516,0.0038879982,0.051965836,-0.13300611,0.07122293,0.02898004,0.0016829309,-0.043446463,0.0076226,-0.054372974,-0.045712,-0.03856139,0.08580735,-0.011557797,-0.039222173,-0.00014251814,0.03091519,-0.014419222,0.010961913,-0.11422101,-0.109029144,0.041511312,-0.054703366,0.046254788,-0.05951764,0.028720448,-0.04007175,0.017251147,-0.059328843,0.029428428,-0.022973998,0.034101106,0.005837897,0.045877196,0.060556013,-0.011286404,0.037641015,-0.00879667,-0.029286832,-0.05498656,0.02706849,-0.06673905,0.00802379,0.005404258,0.018525515,0.07990751,-0.011380802,0.038183797,-0.09043283,0.13498846,0.061216794,-0.021416439,0.008837968,-0.0006781135,0.03346392,0.05220183,0.0058290474,-0.027564077,-0.045641202,-0.067683026,-0.060131222,-0.057110503,0.051352255,0.034077507,-0.00209887,-0.06319914,-0.080332294,-0.011215606,-0.035328273,-0.00419774,0.052532222,0.09227358,0.001601808,0.06395432,-0.0068143215,0.031410776,-0.014655216,-0.03542267,-0.000045516386,0.079057924,0.032968335,0.028012466,-0.031505175,-0.00009937552,-0.01372304,0.058007278,0.02060226,0.010649221,0.04885072,-0.011020911,-0.047434755,0.0609808,0.025204139,-0.015964981,-0.01983528,-0.015363197,0.024614155,-0.015044605,0.038372595,0.007439705,-0.023198191,-0.040921327,0.01411243,-0.036697038,0.06187758,-0.06957097,0.021440038,0.044178043,0.055175353,-0.0120474845,0.03705103,-0.002060521,-0.031033186,0.040850528,-0.02367018,-0.02062586,-0.01721575,-0.024944546,0.018442916,-0.021864828,0.06551188,-0.045169216,-0.047529154,0.043304864,0.025510931,-0.066455856,0.11478739,0.036508244,0.07721718,0.022136219,-0.048307933,-0.002216867,0.004696277,0.021062449,0.022136219,-0.04885072,-0.026360508,-0.0009012014,-0.0016106578,-0.011221506,-0.028319258,0.012543071,-0.013274652,0.09949499,-0.01374664,0.010271631,-0.046726774,-0.025676128,-0.019245295,0.018572712,-0.022207018,-0.022112621,0.0070503154,0.02702129,-0.08283383,0.022419412,-0.0021504937,0.036673438,-0.0071978113,-0.030962389,0.07863314,0.0025354584,-0.0051358156,0.020755656,0.026926894,-0.028106863,-0.0041328417,-0.017711336,0.042809278,0.017734936,0.033865113,0.116014555,0.038396195,-0.057299297,0.015681788,0.01411243,0.0068438207,0.010466326,0.021593435,-0.053759392,0.03617785,-0.03582386,0.00033463186,0.009180159,0.07391326,0.029971214,0.060084026,-0.016873557,-0.028460855,-0.01636617,0.019174498,-0.035540666,0.07145893,-0.046891972,0.057016104,-0.0009624123,0.04132252,0.05154105,-0.034502294,-0.06140559,0.014442821,0.020448864,-0.030679196,-0.016141977,-0.018749708,0.046372786,-0.026431307,-0.025794124,0.0050915666,0.012519471,0.0725917,0.07386606,0.03129278,-0.034997884,-0.06461511,-0.0011010587,0.08358901,-0.04927551,0.030726394,-0.07150613,0.037239823,0.04722236,-0.023080194,0.061216794,-0.116958536,-0.07207251,0.004764125,0.055552945,-0.02633691,0.0190801,-0.013581444,-0.06603107,0.037145425,-0.04724596,0.015221601,-0.058856856,0.021086046,0.022856,0.015752587,0.05456177,0.004241989,-0.014407422,0.00035270012,-0.07093974,0.04311607,0.046018794,-0.041464113,0.027776472,-0.07721718,0.01754614,0.03355832,-0.14433381,0.016956156,0.052107435,-0.009864542,0.025133342,-0.00104501,-0.029971214,-0.009333556,-0.024661353,-0.05262662,0.018041726,0.046750374,0.0052715116,0.030065611,0.083825,0.0013665517,-0.089866444,-0.045617603,0.024755752,0.019965077,0.03849059,0.0063541336,0.03889178,-0.008230284,0.08679853,-0.09430313,0.02702129,-0.013581444,0.071883716,-0.04547601,-0.10176053,-0.02174683,-0.07938832,0.040614534,0.04387125,0.008460378,0.024094969,0.023174593,0.0071919113,-0.0073453076,-0.063671134,0.01682636,-0.063671134,-0.021982824,0.007481004,-0.037593815,0.0067258235,-0.05644972,0.04158211,-0.010000238,0.085618556,0.0343843,0.01945769,0.07537642,0.009109361,-0.0534762,-0.021074247,-0.04797754,0.05187144,0.036390245,0.05418418,-0.07419646,0.0035163078,-0.022266015,-0.010838016,0.06603107,0.013911835,-0.010501725,-0.06551188,-0.011009111,0.0061181397,-0.047481954,-0.053145807,0.07514043,0.028578851,-0.025322136,0.0031770668,-0.014324824,-0.0055399546,-0.01718035,0.008200785,0.010779018,0.06343514,-0.062396765,0.045570407,0.0106079215,-0.0028452005,-0.04502762,0.035729464,-0.0063246344,0.010666921,-0.028696848,-0.03171757,0.0059352443,-0.015457595,-0.034620292,-0.02978242,0.0045310813,-0.03686223,0.015469395,-0.015115404,-0.018490115,-0.008637373,-0.037405018,0.006171238,-0.079057924,-0.0042891875,-0.06173598,-0.043446463,-0.026950493,0.05843207,0.087034516,-0.089772046,-0.05772409,0.0012721542,-0.03511588,0.062632754,0.0034012608,-0.047859546,-0.01636617,0.004646128,-0.1031765,0.024130367,-0.00418004,-0.043399263,0.030608397,0.050880264,0.054750565,0.008112287,-0.038254596,-0.05498656,-0.0150328055,-0.009811442,-0.00457533,0.00002039595,-0.037216224,-0.07825555,-0.074574046,-0.013416248,0.029310431,0.055458546,-0.009357154,-0.038726583,0.0075695016,-0.017439943,0.060084026,-0.017675936,-0.00044101343,-0.057440896,0.009575449,0.04049654,-0.038065802,-0.00572875,-0.0035310574,-0.038986176,0.0343843,-0.13074057,0.03785341,-0.034950685,-0.011215606,-0.052343428,0.029121637,-0.05149385,0.054703366,0.043658856,0.017251147,-0.006188938,-0.089724846,0.015858784,-0.10931233,-0.051729843,0.017628739,-0.02702129,0.010430926,-0.044083644,-0.024118567,0.034974284]
```

ベクトル化されたデータは映画プロット間の類似性比較などに利用可能です。
簡単なセットアップで強力な検索機能を実現できます。

### 4. ベクトル検索の実行

#### 4-1. レコードに対する類似度検索

例えば、タイトルが「Alien」のレコードに対して「Search」ボタンをクリックすると、ベクトル検索することができます。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_search_similarityh_for_record_in_movies_collection.png)

検索を実行すると、テーブルの「Similarity score」列に、「Alien」のプロットに対する類似度スコアが表示されます。
レコードは類似度スコアの昇順で表示されます。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_similarity_score.png)

#### 4-2. キーワードに対する類似度検索

Collection には検索フォームがあるので、例えば、キーワードを「super hero」で検索を実行してみます。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_search_term_with_super_hero_in_movies_collection.png)

すると、The Incredibles、Batman Begins、The Dark Knight、
Spider-Man、Joker、Avengers などのレコードが、類似度スコアの昇順で表示されます。

![](/02-hands-on/02-movie-recommendations-app/10_import_data/data_stax_search_results_of_search_term_with_super_hero_in_movies_collection.png)

### まとめ

このように、Astra DB と OpenAI Embeddings を連携させると、
簡単な操作で高度なベクトル検索機能を利用することができ、データの比較や検索に役立ちます。
